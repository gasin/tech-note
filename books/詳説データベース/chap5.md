## 詳説データベース 5章

### 概要
トランザクション処理

### 気になったことメモ
- ページキャッシュ・バッファキャッシュ
  - ページキャッシュがファイルシステムのキャッシュ
  - バッファキャッシュがブロックI/Oのキャッシュ
  - [参考記事](https://b.l0g.jp/linux/buffercache-and-page-cache/)
  - OS と同様 DB でも似た技術を使う
  - O_DIRECT フラグを使うと Linux kernel のキャッシュをバイパスできるようになる
    - [保証はない](https://stackoverflow.com/a/49462406)らしいが、詳しいことはわからん...
- Belady の異常
  - ページ数を増やしたのにページフォールトが起きる現象のこと
  - FIFO のようなアルゴリズムを採用していると、起きるケースが存在する
    - [参考](https://www.info.kindai.ac.jp/OS/lecture/OS11.pdf)
- ページ置換手法
  - CLOCK sweep
    - 円環上に順にページを見て、値があればクリア、クリアされていればそこを再利用する
    - 実用性の高い手法
  - tinyLFU
    - 使用頻度をもとにページ退避を決めるLFU手法の1つ
      - LFU は速度と精度のトレードオフが難しい
    - [解説記事](https://po3rin.com/blog/tinylfu)を読むと、freshness mechanism など、速度とキャパシティを両方効率化するための工夫が色々されていることが確認できる
- ARIES
  - リカバリのためのアルゴリズム
  - ファジーチェックポイントを使用
    - 同期を一気に行うのではなく、レコードとして同期開始と同期終了を管理する
  - steal/no-force
    - トランザクションがコミットされる前にもページのフラッシュを許可
    - トランザクションがコミットされる前に全てのページがフラッシュ済みであることを要請
  - 復旧手順
    - 分析フェーズ: ダーティページと進行中のトランザクションの特定
    - redoフェーズ: 全ての履歴を再実行する
    - undoフェーズ: 不完全なトランザクションをロールバックする
  - [関連記事](https://qiita.com/kumagi/items/14b6593a2e8ae0c56546)
- トランザクションの分類
  - 猪本のおさらい
  - 実行制御3種
    - 楽観的: 読み取り後に検証を行って競合の検知する
    - MVCC: トランザクションのバージョン管理をする
    - 悲観的: 実行時に競合の検知をする。2相ロックなど
  - 色々なアノマリーの整理
  - 分離レベルと許容されるアノマリーの対応の整理
- ラッチクラビング
  - B treeのラッチを取得する最適化の1つ
  - 木上のノードを辿るたびにラッチが不要になったノードを開放する
