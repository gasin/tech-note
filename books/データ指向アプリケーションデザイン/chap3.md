# データ指向アプリケーションデザイン 3章

### 概要
- DB内のデータ構造の紹介
  - SSTable、LSMツリー、Bツリー
- OLTP と OLAP
- 列指向ストレージ

### 気になったことメモ
- log-structured ストレージとページ指向ストレージ
  - 前者がみたいに後ろに追記していく仕組み
  - 後者が値を書き換えて更新していく仕組み
- SSTable (LSMツリー)
  - メモリ上で平衡二分探索木を管理して、閾値を超えたらディスクに書き出していく
  - 検索の高速化に bloom filter （久しぶりに聞いた）が使われる
  - 元祖は Bigtable で、今も GCP サービスとして使える
    - BigQuery の非構造&低レイテンシ版みたい？（使ったことない）
      - 多分これも知ってるべきなので今度調べる
    - 類似サービスに Apache HBase や Cassandra があるみたい
- SSD の上書き
  - 気にしたことなかったが、Bツリーの文脈で言及されている
  - https://www.diskdeleter.jp/ssd-process/
    - フラッシュメモリには書き込み上限がある
    - ウェアレベリングという技術で、書き込み数を全体に均している
- HDD だとランダムな書き込みが遅い
  - 物理的なディスクの回転及び読み書きヘッドの移動を伴うため
  - HDD は SSD よりも遅いといういうぼんやりとした認識しかなかったので少し解像度が上がった
- ラッチ
  - DB の文脈では、インメモリのデータ構造をいじる処理におけるロックのことを指しているみたい
  - トランザクションのレベルでのロックよりも小さい単位
- 地理空間インデックス
  - 地理的な2次元での絞り込み検索が DB engine でサポートされていることがある
    - 少しググっただけでも MySQL, Redis, MongoDB などメジャーなところはサポートしてた
  - PostgreSQL だと GiST index と呼ばれる汎用検索インデックスと、[PostGIS](https://postgis.net/) という地理データ用の拡張を用いると色々できるみたい
    - インデックスは他にもいくつかあるみたい https://www.postgresql.jp/document/9.6/html/indexes-types.html
- レーベンシュタインオートマトン 
  - 全文検索エンジンの Lucene 内で使われているらしい
  - [この記事](http://blog.notdot.net/2010/07/Damn-Cool-Algorithms-Levenshtein-Automata)がアルゴリズムの話で面白い
    - 実際にどうやってオートマトンをソートされた文字列に対する検索に使うのかの話
    - NFA -> DFA した後、辞書順で今見てる文字列以降でマッチする文字列を考えることで高速化している
- OLTP と OLAP
  - BigQuery みたいなのが OLAP で Cloud SQL みたいなのが OLTP
  - 感覚的に把握してたが、言葉として整理できてなかった
- 列指向ストレージ
  - 個人的には BigQuery のことねという把握をした
    - よく耳にする Snowflake（使ったことない）も列指向らしい
    - というかググった感じ、BigQuery の AWS 版みたいなものらしい
  - BigQuery での圧縮とかは気にしたことなかったが、文中にあるように、Parquet と似たようなもののよう
  - LSM ツリーの仕組みを使うと書き込みも効率化できるとあって、話が繋がった感じがある